// GENERATED BY CFD2 CODEGEN (generic_coupled_apply)

// DO NOT EDIT MANUALLY

struct Constants {
    dt: f32,
    dt_old: f32,
    dtau: f32,
    time: f32,
    viscosity: f32,
    density: f32,
    component: u32,
    alpha_p: f32,
    scheme: u32,
    alpha_u: f32,
    stride_x: u32,
    time_scheme: u32,
    eos_gamma: f32,
    eos_gm1: f32,
    eos_r: f32,
    eos_dp_drho: f32,
    eos_p_offset: f32,
    eos_theta_ref: f32,
}

// Group 0: CSR matrix

@group(0) @binding(0) 
var<storage, read> row_offsets: array<u32>;

@group(0) @binding(1) 
var<storage, read> col_indices: array<u32>;

@group(0) @binding(2) 
var<storage, read> matrix_values: array<f32>;

// Group 1: vectors

@group(1) @binding(0) 
var<storage, read> x: array<f32>;

@group(1) @binding(1) 
var<storage, read_write> y: array<f32>;

@group(1) @binding(2) 
var<uniform> constants: Constants;

@compute
@workgroup_size(64)
fn main(@builtin(global_invocation_id) global_id: vec3<u32>) {
    let row = global_id.y * constants.stride_x + global_id.x;
    let n = arrayLength(&row_offsets) - 1u;
    if (row >= n) {
        return;
    }
    let start = row_offsets[row];
    let end = row_offsets[row + 1u];
    var sum: f32 = 0.0;
    for (var i = start; i < end; i++) {
        let col = col_indices[i];
        let val = matrix_values[i];
        let x_val = x[col];
        sum += val * x_val;
    }
    y[row] = sum;
}
